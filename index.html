<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>복승식 회피 판단 분석기 v2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: monospace;
            margin-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        button {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }
        
        .result {
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .badge-danger {
            background: #ff4757;
            color: white;
        }
        
        .badge-success {
            background: #2ed573;
            color: white;
        }
        
        .metric {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .metric-value.danger {
            color: #ff4757;
        }
        
        .metric-value.success {
            color: #2ed573;
        }
        
        .final-decision {
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: white;
        }
        
        .final-decision.danger {
            background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
        }
        
        .final-decision.success {
            background: linear-gradient(135deg, #2ed573 0%, #7bed9f 100%);
        }
        
        .final-decision h2 {
            font-size: 32px;
            margin: 20px 0;
        }
        
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>복승식 회피 판단 분석기</h1>
            <p>초고배당 경주 회피 도구</p>
        </div>
        
        <div class="content">
            <textarea id="dataInput" placeholder="복승식 배당 데이터를 붙여넣으세요"></textarea>
            
            <div class="button-group">
                <button class="btn-primary" onclick="analyze()">분석하기</button>
                <button class="btn-secondary" onclick="clearData()">초기화</button>
            </div>
            
            <div id="result" class="result"></div>
        </div>
    </div>

    <script>
        function clearData() {
            document.getElementById('dataInput').value = '';
            document.getElementById('result').classList.remove('show');
        }

        function analyze() {
            const input = document.getElementById('dataInput').value.trim();
            
            if (!input) {
                alert('데이터를 입력해주세요');
                return;
            }

            try {
                const lines = input.split('\n');
                const pairs = [];
                const horseMaxOdds = {};

                lines.forEach(line => {
                    const parts = line.split(/\s+/);
                    for (let i = 0; i < parts.length; i += 2) {
                        if (i + 1 < parts.length) {
                            const horses = parts[i];
                            const odds = parseFloat(parts[i + 1]);
                            
                            if (horses && !isNaN(odds)) {
                                pairs.push({ horses, odds });
                                
                                const horseNumbers = horses.match(/[①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯]/g) || [];
                                horseNumbers.forEach(horse => {
                                    if (!horseMaxOdds[horse] || horseMaxOdds[horse] < odds) {
                                        horseMaxOdds[horse] = odds;
                                    }
                                });
                            }
                        }
                    }
                });

                if (pairs.length === 0) {
                    alert('데이터 형식이 올바르지 않습니다');
                    return;
                }

                // 500배 이상 마번
                const totalHorses = Object.keys(horseMaxOdds).length;
                const dangerHorses500 = Object.entries(horseMaxOdds).filter(([_, odds]) => odds >= 500);
                const ratio500 = (dangerHorses500.length / totalHorses * 100);

                // 500배 이상 조합
                const highPairs = pairs.filter(p => p.odds >= 500).length;
                const highRatio = (highPairs / pairs.length * 100);

                // 편차 계산
                const sortedPairs = [...pairs].sort((a, b) => a.odds - b.odds);
                const top5 = sortedPairs.slice(0, 5);
                const maxOdds = Math.max(...top5.map(p => p.odds));
                const minOdds = Math.min(...top5.map(p => p.odds));
                const variance = maxOdds / minOdds;

                // 판정
                const isDanger = ratio500 >= 40 || highRatio >= 20 || variance >= 15;

                displayResult(isDanger, ratio500, highRatio, variance, dangerHorses500.length, totalHorses);

            } catch (error) {
                alert('분석 중 오류: ' + error.message);
            }
        }

        function displayResult(isDanger, ratio500, highRatio, variance, dangerCount, totalHorses) {
            const html = `
                <div class="result-card">
                    <div class="badge ${ratio500 >= 40 ? 'badge-danger' : 'badge-success'}">
                        위험 마번: ${ratio500 >= 40 ? '위험' : '안전'}
                    </div>
                    
                    <div class="metric">
                        <span>위험 마번 비율 (500배 이상)</span>
                        <span class="metric-value ${ratio500 >= 40 ? 'danger' : 'success'}">
                            ${ratio500.toFixed(1)}%
                        </span>
                    </div>
                    
                    <div class="metric">
                        <span>위험 마번 수</span>
                        <span class="metric-value">${dangerCount} / ${totalHorses}</span>
                    </div>
                    
                    <div class="metric">
                        <span>고배당 조합 비율</span>
                        <span class="metric-value ${highRatio >= 20 ? 'danger' : 'success'}">
                            ${highRatio.toFixed(1)}%
                        </span>
                    </div>
                    
                    <div class="info-box">
                        기준 1: 500배 이상 마번이 40% 이상이면 위험<br>
                        기준 2: 500배 이상 조합이 20% 이상이면 위험
                    </div>
                </div>

                <div class="result-card">
                    <div class="badge ${variance >= 15 ? 'badge-danger' : 'badge-success'}">
                        편차 지수: ${variance >= 15 ? '위험' : '안전'}
                    </div>
                    
                    <div class="metric">
                        <span>편차 지수</span>
                        <span class="metric-value ${variance >= 15 ? 'danger' : 'success'}">
                            ${variance.toFixed(1)}배
                        </span>
                    </div>
                    
                    <div class="info-box">
                        기준: TOP5 조합의 최고/최저 배당 비율이 15배 이상이면 위험
                    </div>
                </div>

                <div class="final-decision ${isDanger ? 'danger' : 'success'}">
                    <div style="font-size: 48px;">${isDanger ? '⚠️' : '✅'}</div>
                    <h2>${isDanger ? '회피 권장' : '베팅 고려 가능'}</h2>
                    <p style="font-size: 16px; line-height: 1.8; margin-top: 15px;">
                        ${isDanger ? 
                            '위험 마번 ' + ratio500.toFixed(1) + '% + 고배당 조합 ' + highRatio.toFixed(1) + '% + 편차 ' + variance.toFixed(1) + '배로 초고배당 가능성이 높습니다. 회피를 권장합니다.' :
                            '위험 마번 ' + ratio500.toFixed(1) + '% + 고배당 조합 ' + highRatio.toFixed(1) + '% + 편차 ' + variance.toFixed(1) + '배로 안전 구간입니다. 추가 정보를 참고하여 신중하게 판단하세요.'
                        }
                    </p>
                </div>
            `;

            document.getElementById('result').innerHTML = html;
            document.getElementById('result').classList.add('show');
        }
    </script>
</body>
</html>